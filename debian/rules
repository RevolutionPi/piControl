#!/usr/bin/make -f

include /usr/share/dpkg/pkg-info.mk
include debian/rules.vars

SRC_PKG_DIR = $(shell pwd)
make-opts = -C /lib/modules/$(KERNELRELEASE)/build M=$(SRC_PKG_DIR)/src

ifneq (,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
    NUMJOBS = $(patsubst parallel=%,%,$(filter parallel=%,$(DEB_BUILD_OPTIONS)))
    MAKEFLAGS += -j$(NUMJOBS)
endif

%:
	dh $@

override_dh_auto_build:
	$(MAKE) $(make-opts) modules


override_dh_auto_clean:
	$(MAKE) $(make-opts) clean
	dh_auto_clean

override_dh_auto_install:
	$(MAKE) $(make-opts) INSTALL_MOD_PATH=$(SRC_PKG_DIR)/debian/picontrol-$(KERNELRELEASE) INSTALL_MOD_STRIP=1 modules_install
	dh_auto_install
